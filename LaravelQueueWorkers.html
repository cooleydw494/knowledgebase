<!DOCTYPE html><html><head>  <title>Chat GPT Conversation</title>  <meta name="generator" content="chatGPT Saving Bookmark"/><style>body > .w-full:nth-child(2n+1) {    background: lightgray;}body > .w-full:nth-child(2n+2) {    background: darkgray;}body > .w-full {    padding: 10px;    margin: 10px;    border-radius: 5px;}.whitespace-pre-wrap {    white-space: pre-wrap;}p:first-child {  margin-top: 0;}p:last-child {  margin-bottom: 0;}</style><link rel="stylesheet"      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/default.min.css"/></head><body><div class="w-full border-b border-black/10 dark:border-gray-900/50 text-gray-800 dark:text-gray-100 group dark:bg-gray-800"><div class="text-base gap-4 md:gap-6 m-auto md:max-w-2xl lg:max-w-2xl xl:max-w-3xl p-4 md:py-6 flex lg:px-0"><div class="relative flex w-[calc(100%-50px)] md:flex-col lg:w-[calc(100%-115px)]"><div class="flex flex-grow flex-col gap-3">
<div class="w-full border-b border-black/10 dark:border-gray-900/50 text-gray-800 dark:text-gray-100 group dark:bg-gray-800"><div class="text-base gap-4 md:gap-6 m-auto md:max-w-2xl lg:max-w-2xl xl:max-w-3xl p-4 md:py-6 flex lg:px-0"><div class="relative flex w-[calc(100%-50px)] md:flex-col lg:w-[calc(100%-115px)]"><div class="flex flex-grow flex-col gap-3"><div class="min-h-[20px] flex flex-col items-start gap-4 whitespace-pre-wrap">can you give me that written in markdown format that I can copy and paste (so that I can save it in my README.md file)?</div></div></div></div></div><div class="w-full border-b border-black/10 dark:border-gray-900/50 text-gray-800 dark:text-gray-100 group bg-gray-50 dark:bg-[#444654]"><div class="text-base gap-4 md:gap-6 m-auto md:max-w-2xl lg:max-w-2xl xl:max-w-3xl p-4 md:py-6 flex lg:px-0"><div class="relative flex w-[calc(100%-50px)] md:flex-col lg:w-[calc(100%-115px)]"><div class="flex flex-grow flex-col gap-3"><div class="min-h-[20px] flex flex-col items-start gap-4 whitespace-pre-wrap"><div class="markdown prose w-full break-words dark:prose-invert dark"><p>Certainly! Here is the complete guide in markdown format that you can copy and paste:</p><h1>Setting up Laravel queue workers on Ubuntu using supervisor</h1><h2>Prerequisites</h2><ul><li>Ubuntu server with Apache or Nginx installed and configured</li><li>PHP and required PHP extensions installed and configured</li><li>MySQL or PostgreSQL database server installed and configured</li><li>Laravel project installed and configured</li></ul><h2>Step 1: Install supervisor</h2><pre><div class="bg-black mb-4 rounded-md"><div class="p-4 overflow-y-auto"><code class="!whitespace-pre-wrap hljs language-bash">sudo apt-get install supervisor
</code></div></div></pre><h2>Step 2: Create a configuration file for the queue worker</h2><p>Create a configuration file for the queue worker in the <code>/etc/supervisor/conf.d/</code> directory. The file should have a <code>.conf</code> extension and should be named something descriptive (e.g. <code>laravel-queue-worker.conf</code>).</p><p>Add the following content to the configuration file:</p><pre><div class="bg-black mb-4 rounded-md"><div class="p-4 overflow-y-auto"><code class="!whitespace-pre-wrap hljs language-makefile"><span class="hljs-section">[program:laravel-queue-worker]</span>
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/your/laravel/project/artisan queue:work --sleep=3 --tries=3
autostart=true
autorestart=true
user=www-data
numprocs=4
redirect_stderr=true
stdout_logfile=/path/to/your/laravel/project/storage/logs/worker.log
</code></div></div></pre><p>Replace <code>/path/to/your/laravel/project/</code> with the actual path to your Laravel project on your server. The <code>--sleep</code> and <code>--tries</code> options control how long the worker should wait between checking for new jobs, and how many times it should attempt to process a job before giving up. You can adjust these values to suit your needs.</p><h2>Step 3: Tell supervisor to read the new configuration file</h2><pre><div class="bg-black mb-4 rounded-md"><div class="p-4 overflow-y-auto"><code class="!whitespace-pre-wrap hljs language-bash">sudo supervisorctl reread
</code></div></div></pre><h2>Step 4: Start the queue worker</h2><pre><div class="bg-black mb-4 rounded-md"><div class="p-4 overflow-y-auto"><code class="!whitespace-pre-wrap hljs language-bash">sudo supervisorctl start laravel-queue-worker
</code></div></div></pre><p>The queue worker should now be running, and supervisor will automatically start the worker if it stops or crashes for any reason.</p><h2>Step 5: Set up a cron job to periodically check that the worker is running</h2><pre><div class="bg-black mb-4 rounded-md"><div class="p-4 overflow-y-auto"><code class="!whitespace-pre-wrap hljs language-bash">crontab -e
</code></div></div></pre><p>Add the following line to the crontab file to run a script every minute that checks if the queue worker is running and restarts it if necessary:</p><pre><div class="bg-black mb-4 rounded-md"><div class="p-4 overflow-y-auto"><code class="!whitespace-pre-wrap hljs language-javascript">* * * * * <span class="hljs-regexp">/path/</span>to/your/script.<span class="hljs-property">sh</span>
</code></div></div></pre><p>Create the script file at the specified path (e.g. <code>/path/to/your/script.sh</code>). The script should contain the following code:</p><pre><div class="bg-black mb-4 rounded-md"><div class="p-4 overflow-y-auto"><code class="!whitespace-pre-wrap hljs language-bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># Check if the queue worker is running</span>
<span class="hljs-keyword">if</span> ! (pgrep -f <span class="hljs-string">"queue:work"</span> &gt; /dev/null)
<span class="hljs-keyword">then</span>
    <span class="hljs-comment"># Restart the queue worker</span>
    supervisorctl start laravel-queue-worker
<span class="hljs-keyword">fi</span>
</code></div></div></pre><p>Make the script executable by running the following command:</p><pre><div class="bg-black mb-4 rounded-md"><div class="p-4 overflow-y-auto"><code class="!whitespace-pre-wrap hljs language-bash"><span class="hljs-built_in">chmod</span> +x /path/to/your/script.sh
</code></div></div></pre><p>This cron job will now run every minute and check if the queue worker is running. If it is not running, the script will restart it using supervisor.</p></div></div></div></div></div></div></body></html>
